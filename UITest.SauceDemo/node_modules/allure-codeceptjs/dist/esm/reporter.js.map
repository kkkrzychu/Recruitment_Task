{"version":3,"file":"reporter.js","names":["event","recorder","env","LabelName","Stage","Status","getMessageAndTraceFromError","getStatusFromError","isMetadataTag","stripAnsi","AllureMochaReporter","MAX_META_STEP_NESTING","AllureCodeceptJsReporter","constructor","runner","opts","isInWorker","_defineProperty","undefined","registerEvents","dispatcher","on","test","before","testStarted","bind","failed","testFailed","finished","testFinished","step","started","stepStarted","passed","stepPassed","stepFailed","comment","stepComment","bddStep","bddStepStarted","after","currentTest","tags","extraTagLabels","filter","tag","map","startsWith","substring","trim","length","name","TAG","value","runtime","updateTest","tr","labels","push","_","error","status","message","statusDetails","currentBddStep","stopCurrentStep","result","stage","FINISHED","BROKEN","_objectSpread","id","metaStepStack","updateStep","stopStep","PASSED","currentLeafStep","_this$currentHook","_this$metaStepStack$i2","_this$metaStepStack2","root","currentHook","stepPath","current","metaStep","isBDD","_current$toString","unshift","toString","index","Math","min","i","s","slice","_this$metaStepStack$i","_this$metaStepStack","parentId","startStep","parent","_this$currentHook2","keyword","text","inspect","TRY_TO","FAILED","updateFunc","_this$currentHook3","currentStep","stopStepById","promise","catch","err","Error","Promise","reject"],"sources":["../../src/reporter.ts"],"sourcesContent":["import { event, recorder } from \"codeceptjs\";\nimport type * as Mocha from \"mocha\";\nimport { env } from \"node:process\";\nimport { LabelName, Stage, Status, type StepResult } from \"allure-js-commons\";\nimport { getMessageAndTraceFromError, getStatusFromError, isMetadataTag, stripAnsi } from \"allure-js-commons/sdk\";\nimport AllureMochaReporter from \"allure-mocha\";\nimport type { CodeceptBddStep, CodeceptError, CodeceptStep } from \"./model.js\";\n\ninterface MetaStep {\n  name: string;\n  id: string;\n}\n\nconst MAX_META_STEP_NESTING = 10;\n\nexport class AllureCodeceptJsReporter extends AllureMochaReporter {\n  protected currentBddStep?: string;\n  protected metaStepStack: MetaStep[] = [];\n  protected currentLeafStep?: string;\n\n  constructor(runner: Mocha.Runner, opts: Mocha.MochaOptions, isInWorker: boolean) {\n    super(runner, opts, isInWorker);\n    this.registerEvents();\n  }\n\n  registerEvents() {\n    // Test\n    event.dispatcher.on(event.test.before, this.testStarted.bind(this));\n    event.dispatcher.on(event.test.failed, this.testFailed.bind(this));\n    event.dispatcher.on(event.test.finished, this.testFinished.bind(this));\n    // Step\n    event.dispatcher.on(event.step.started, this.stepStarted.bind(this));\n    event.dispatcher.on(event.step.passed, this.stepPassed.bind(this));\n    event.dispatcher.on(event.step.failed, this.stepFailed.bind(this));\n    event.dispatcher.on(event.step.comment, this.stepComment.bind(this));\n\n    event.dispatcher.on(event.bddStep.before, this.bddStepStarted.bind(this));\n    event.dispatcher.on(event.bddStep.after, this.stepPassed.bind(this));\n  }\n\n  testStarted(test: { tags?: string[] }) {\n    if (!this.currentTest) {\n      return;\n    }\n\n    const tags = test.tags || [];\n    const extraTagLabels = tags\n      .filter((tag) => tag && !isMetadataTag(tag))\n      .map((tag) => (tag.startsWith(\"@\") ? tag.substring(1) : tag))\n      .map((tag) => tag.trim())\n      .filter((tag) => tag.length > 0)\n      .map((tag) => ({ name: LabelName.TAG, value: tag }));\n\n    this.runtime.updateTest(this.currentTest, (tr) => {\n      tr.labels.push(...extraTagLabels);\n    });\n  }\n\n  testFailed(_: {}, error: Error) {\n    const status = getStatusFromError({ message: error.message } as Error);\n    const statusDetails = getMessageAndTraceFromError(error);\n    if (this.currentBddStep) {\n      this.stopCurrentStep((result) => {\n        result.stage = Stage.FINISHED;\n        result.status = Status.BROKEN;\n        if (error) {\n          result.status = status;\n          result.statusDetails = { ...statusDetails };\n        }\n      });\n    }\n    this.currentBddStep = undefined;\n\n    for (const { id } of this.metaStepStack) {\n      this.runtime.updateStep(id, (result) => {\n        result.stage = Stage.FINISHED;\n        result.status = Status.BROKEN;\n        if (error) {\n          result.status = status;\n          result.statusDetails = { ...statusDetails };\n        }\n      });\n      this.runtime.stopStep(id);\n    }\n    this.metaStepStack = [];\n  }\n\n  testFinished() {\n    if (this.currentBddStep) {\n      this.runtime.updateStep(this.currentBddStep, (result) => {\n        result.status = Status.PASSED;\n        result.stage = Stage.FINISHED;\n      });\n      this.runtime.stopStep(this.currentBddStep);\n    }\n    this.currentBddStep = undefined;\n\n    for (const { id } of this.metaStepStack) {\n      this.runtime.updateStep(id, (result) => {\n        result.status = Status.PASSED;\n        result.stage = Stage.FINISHED;\n      });\n      this.runtime.stopStep(id);\n    }\n\n    this.metaStepStack = [];\n    this.currentLeafStep = undefined;\n  }\n\n  stepStarted(step: CodeceptStep) {\n    const root = this.currentHook ?? this.currentTest;\n    if (!root) {\n      return;\n    }\n\n    const stepPath: string[] = [];\n    let current = step.metaStep;\n    while (current && !current.isBDD() && stepPath.length < MAX_META_STEP_NESTING) {\n      stepPath.unshift(stripAnsi(current.toString() ?? \"\").trim());\n      current = current.metaStep;\n    }\n\n    let index = 0;\n    while (\n      index < Math.min(this.metaStepStack.length, stepPath.length) &&\n      this.metaStepStack[index].name === stepPath[index]\n    ) {\n      index++;\n    }\n\n    for (let i = this.metaStepStack.length - 1; i >= index; i--) {\n      const { id } = this.metaStepStack[i];\n      this.runtime.updateStep(id, (s) => {\n        s.status = Status.PASSED;\n        s.stage = Stage.FINISHED;\n      });\n      this.runtime.stopStep(id);\n    }\n    this.metaStepStack = this.metaStepStack.slice(0, index);\n\n    for (let i = index; i < stepPath.length; i++) {\n      const name = stepPath[i];\n      const parentId = this.metaStepStack[i - 1]?.id ?? root;\n      const id = this.runtime.startStep(parentId, undefined, {\n        name,\n      });\n      if (id) {\n        this.metaStepStack.push({ name, id });\n      }\n    }\n\n    const parent = this.metaStepStack[this.metaStepStack.length - 1]?.id ?? root;\n    this.currentLeafStep = this.runtime.startStep(parent, undefined, {\n      name: step.toString().trim(),\n    });\n  }\n\n  bddStepStarted(step: CodeceptBddStep) {\n    const root = this.currentHook ?? this.currentTest;\n    if (!root) {\n      return;\n    }\n    if (this.currentBddStep) {\n      this.runtime.updateStep(this.currentBddStep, (result) => {\n        result.status = Status.PASSED;\n        result.stage = Stage.FINISHED;\n      });\n      this.runtime.stopStep(this.currentBddStep);\n    }\n    this.currentBddStep = this.runtime.startStep(root, undefined, {\n      name: step.keyword + step.text,\n    });\n  }\n\n  // according to the docs, codeceptjs supposed to report the error,\n  // but actually it's never reported\n  stepFailed(_: CodeceptJS.Step, error?: CodeceptError) {\n    if (!this.currentLeafStep) {\n      return;\n    }\n\n    this.runtime.updateStep(this.currentLeafStep, (result) => {\n      result.stage = Stage.FINISHED;\n      if (error) {\n        if (!error.message && typeof error.inspect === \"function\") {\n          error.message = error.inspect();\n        }\n        result.status = getStatusFromError(error as unknown as Error);\n        result.statusDetails = getMessageAndTraceFromError(error as unknown as Error);\n      } else {\n        result.status = env.TRY_TO === \"true\" ? Status.BROKEN : Status.FAILED;\n      }\n    });\n    this.runtime.stopStep(this.currentLeafStep);\n    this.currentLeafStep = undefined;\n  }\n\n  stepComment() {\n    this.stopCurrentStep((result) => {\n      result.status = Status.PASSED;\n      result.stage = Stage.FINISHED;\n    });\n  }\n\n  stepPassed() {\n    if (this.currentBddStep && !this.currentLeafStep) {\n      this.runtime.updateStep(this.currentBddStep, (result) => {\n        result.status = Status.PASSED;\n        result.stage = Stage.FINISHED;\n      });\n      this.runtime.stopStep(this.currentBddStep);\n      this.currentBddStep = undefined;\n      return;\n    }\n\n    if (!this.currentLeafStep) {\n      return;\n    }\n\n    this.runtime.updateStep(this.currentLeafStep, (result) => {\n      result.status = Status.PASSED;\n      result.stage = Stage.FINISHED;\n    });\n    this.runtime.stopStep(this.currentLeafStep);\n    this.currentLeafStep = undefined;\n  }\n\n  stopCurrentStep(updateFunc: (result: StepResult) => void) {\n    const root = this.currentHook ?? this.currentTest;\n    const currentStep = root ? this.runtime.currentStep(root) : undefined;\n\n    this.stopStepById(currentStep, updateFunc);\n  }\n\n  stopStepById(currentStep: string | undefined, updateFunc: (result: StepResult) => void) {\n    if (!currentStep) {\n      return;\n    }\n    const promise = recorder.promise();\n    // @ts-ignore\n    if (promise) {\n      promise.catch((err) => {\n        if (!err.message && typeof err.inspect === \"function\") {\n          // AssertionFailedError doesn't set message attribute\n          err.message = err.inspect();\n        }\n        if (err instanceof Error || err.constructor.name === \"Error\") {\n          this.runtime.updateStep(currentStep, (step) => {\n            step.status = getStatusFromError(err as Error);\n            step.statusDetails = { ...step.statusDetails, ...getMessageAndTraceFromError(err as Error) };\n          });\n        }\n        return Promise.reject(err);\n      });\n    }\n\n    this.runtime.updateStep(currentStep, updateFunc);\n    this.runtime.stopStep(currentStep);\n  }\n\n  protected getFrameworkName = () => \"codeceptjs\";\n\n  protected getWorkerId = () => undefined;\n}\n"],"mappings":"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","ignoreList":[]}